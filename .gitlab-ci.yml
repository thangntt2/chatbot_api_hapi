image: node:boron

stages:
  - prepare_dependencies
  - migrate
  - build
  - run

install_dependencies:
  stage: prepare_dependencies
  cache:
    paths:
      - node_modules
  script:
    - npm install

migrate:
  stage: migrate
  script:
    - export MYSQL_HOST="localhost"
    - export MYSQL_PORT="3306"
    - export MYSQL_USER="root"
    - export MYSQL_PASSWORD="nhuthienthu1"
    - export MYSQL_DATABASE="vizbot"
    - npm run migrate:latest

build:
  stage: build
  cache:
    paths:
      - dist
  script:
    - npm run build

run:
  stage: run
  script:
    - npm run start --production
